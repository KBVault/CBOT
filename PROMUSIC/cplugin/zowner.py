from pyrogram import Client, filters
import requests
import random
import os
import re
import asyncio
import time
from PROMUSIC import app
from PROMUSIC.utils.database import add_served_chat_clone, delete_served_chat_clone
from pyrogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton
from PROMUSIC.utils.database import get_assistant
import asyncio
from PROMUSIC.misc import SUDOERS
from PROMUSIC.mongo.afkdb import LOGGERS as OWNERS
from PROMUSIC.core.userbot import Userbot
from pyrogram import Client, filters
from pyrogram.errors import UserAlreadyParticipant
from PROMUSIC import app
import asyncio
import random
from pyrogram import Client, filters
from pyrogram.enums import ChatMemberStatus
from pyrogram.errors import (
    ChatAdminRequired,
    InviteRequestSent,
    UserAlreadyParticipant,
    UserNotParticipant,
)
from PROMUSIC import app
from PROMUSIC.utils.pro_ban import admin_filter
from PROMUSIC.utils.decorators.userbotjoin import UserbotWrapper #change
from PROMUSIC.utils.database import get_assistant, is_active_chat

caption = f"""**
âœª Ï‰Îµâ„“á´„ÏƒĞ¼Ñ” fÏƒÊ€ PÊ€á´Bá´á´›s Ê€Ñ”ÏÏƒÑ• âœª
 
 â² á´€ÊŸÊŸ Ê€á´‡á´˜á´ á´‡á´€sÉªÊŸÊ á´…á´‡á´˜ÊŸá´Ê á´É´ Êœá´‡Ê€á´á´‹á´œ á´¡Éªá´›Êœá´á´œá´› á´€É´Ê á´‡Ê€Ê€á´Ê€ âœ°
 
 â² É´á´ Êœá´‡Ê€á´á´‹á´œ Ê™á´€É´ Éªssá´œá´‡ âœ°
 
 â² É´á´ Éªá´… Ê™á´€É´ Éªssá´œá´‡ âœ°
 
 â²á´œÉ´ÊŸÉªá´Éªá´›á´‡á´… á´…ÊÉ´á´s âœ°
 
 â² Ê€á´œÉ´ 24x7 ÊŸá´€É¢ Ò“Ê€á´‡á´‡ á´¡Éªá´›Êœá´á´œá´› sá´›á´á´˜ âœ°
 
 â–º ÉªÒ“ Êá´á´œ Ò“á´€á´„á´‡ á´€É´Ê á´˜Ê€á´Ê™ÊŸá´‡á´ á´›Êœá´‡É´ sá´‡É´á´… ss
**"""

buttons = [
        [ 
          InlineKeyboardButton("ğ—”ğ——ğ—— ğ—¡ğ—˜ğ—­ğ—¨ğ—ğ—¢", url=f"https://t.me/NezukoProBot?startgroup=true")
        ],
        [
          InlineKeyboardButton("ğ—›ğ—˜ğ—Ÿğ—£", url="https://t.me/ProBotGc"),
          InlineKeyboardButton("ğ—¢ğ—ªğ—¡ğ—˜ğ—¥", url="https://t.me/ZeoXpro"),
          ],
               [
                InlineKeyboardButton("ğ—¨ğ—£ğ——ğ—”ğ—§ğ—˜", url="https://t.me/ProBotts"),

]]

@Client.on_message(filters.command("repo") & filters.group)
async def repo(client: Client, message: Message):
    await message.reply_photo(
        photo=f"https://telegra.ph/file/93fe8699ccadb924effad.jpg",
        caption=caption,
        reply_markup=buttons
    )


@Client.on_message(filters.command("repo") & filters.group)
async def help(client: Client, message: Message):

    await message.reply_photo(
        photo=f"https://telegra.ph/file/93fe8699ccadb924effad.jpg",
        caption=caption,
        reply_markup=buttons
    )


@Client.on_message(filters.command("repo") & filters.private)
async def help(client: Client, message: Message):
    await message.reply_photo(
        photo=f"https://telegra.ph/file/93fe8699ccadb924effad.jpg",
        caption=caption,
        reply_markup=buttons
    )


# --------------------------------------------------------------------------------- #


@Client.on_message(
    filters.command(
        ["hi", "hii", "hello", "hui", "good", "gm", "ok", "bye", "welcome", "thanks"],
        prefixes=["/", "!", "%", ",", "", ".", "@", "#"],
    )
    & filters.group
)
async def bot_check(_, message):
    chat_id = message.chat.id
    await add_served_chat_clone(chat_id)


# --------------------------------------------------------------------------------- #


import asyncio
import time


@Client.on_message(filters.command("gadd") & filters.user(int(OWNERS)))
async def add_all(client, message):
    command_parts = message.text.split(" ")
    if len(command_parts) != 2:
        await message.reply(
            "**âš ï¸ ÉªÉ´á´ á´€ÊŸÉªá´… á´„á´á´á´á´€É´á´… Ò“á´Ê€á´á´€á´›. á´˜ÊŸá´‡á´€sá´‡ á´œsá´‡ ÊŸÉªá´‹á´‡ Â» `/gadd `**"
        )
        return

    bot_username = command_parts[1]
    try:
        userbot = await get_assistant(message.chat.id)
        bot = await client.get_users(bot_username)
        app_id = bot.id
        done = 0
        failed = 0
        lol = await message.reply("ğŸ”„ **á´€á´…á´…ÉªÉ´É¢ É¢Éªá´ á´‡É´ Ê™á´á´› ÉªÉ´ á´€ÊŸÊŸ á´„Êœá´€á´›s!**")

        async for dialog in userbot.get_dialogs():
            if dialog.chat.id == -1002100130095: 
                continue
            try:
                await userbot.add_chat_members(dialog.chat.id, app_id)
                done += 1
                await lol.edit(
                    f"**ğŸ”‚ á´€á´…á´…ÉªÉ´É¢ {bot_username}**\n\n**â¥ á´€á´…á´…á´‡á´… ÉªÉ´ {done} á´„Êœá´€á´›s âœ…**\n**â¥ Ò“á´€ÉªÊŸá´‡á´… ÉªÉ´ {failed} á´„Êœá´€á´›s âŒ**\n\n**â² á´€á´…á´…á´‡á´… Ê™ÊÂ»** @{userbot.username}"
                )
            except Exception as e:
                failed += 1
                await lol.edit(
                    f"**ğŸ”‚ á´€á´…á´…ÉªÉ´É¢ {bot_username}**\n\n**â¥ á´€á´…á´…á´‡á´… ÉªÉ´ {done} á´„Êœá´€á´›s âœ…**\n**â¥ Ò“á´€ÉªÊŸá´‡á´… ÉªÉ´ {failed} á´„Êœá´€á´›s âŒ**\n\n**â² á´€á´…á´…ÉªÉ´É¢ Ê™ÊÂ»** @{userbot.username}"
                )
            await asyncio.sleep(3)  # Adjust sleep time based on rate limits

        await lol.edit(
            f"**â» {bot_username} Ê™á´á´› á´€á´…á´…á´‡á´… sá´œá´„á´„á´‡ssÒ“á´œÊŸÊŸÊğŸ‰**\n\n**â¥ á´€á´…á´…á´‡á´… ÉªÉ´ {done} á´„Êœá´€á´›s âœ…**\n**â¥ Ò“á´€ÉªÊŸá´‡á´… ÉªÉ´ {failed} á´„Êœá´€á´›s âŒ**\n\n**â² á´€á´…á´…á´‡á´… Ê™ÊÂ»** @{userbot.username}"
        )
    except Exception as e:
        await message.reply(f"Error: {str(e)}")
